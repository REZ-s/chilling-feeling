<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="IE=edge" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">

    <title> Chilling Feeling - Search </title>

    <link rel="shortcut icon" href="/images/favicon_16px.png">
    <link href="/css/cf_style.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="/js/script.js"></script>

</head>
<body>
<div class="search-container">
    <!-- Header -->
    <section class="wrap-search-top-bar-best-search-word">
        <div class="search-top-bar">
            <a href="javascript:history.back()">
                <img src="/images/ic_back_black_24px.png" class="ic_back_24px">
            </a>

            <div class="search-form-result">
                <input class="search-form-input-result" placeholder="어떤 주류를 찾으시나요?" id="searchInput">
                <div class="wrap-ic-search-form-result">
                    <button class="ic_form_close_16px" id="searchInputClear">
                        <img src="/images/ic_form_close_16px.png">
                    </button>
                    <button class="ic_search_24px" id="searchButton">
                        <img src="/images/ic_search_black_24px.png">
                    </button>
                </div>
            </div>

            <button class="ic_shopping_bag_24px" onclick="location.href='/cart'">
                <img src="/images/ic_shopping_bag_black_24px.png">
            </button>
        </div>

        <!-- simply form -->
        <div class="wrap-best-search" id="simplyBestSearch">
<!--            <div class="wrap-best-search-tit-keyword">
                <div class="best-search-title">
                    <div class="best-search-title-label">인기검색어</div>
                </div>
                <div class="best-search-keyword">
                    <div class="best-search-keyword-num">1</div>
                    <div class="best-search-keyword-name">-</div>
                    <div class="best-search-keyword-rank-up">new</div>
                </div>
            </div>
            <button class="ic_chevron_down_14px" id="toggleBtnBefore">
                <img src="/images/ic_chevron_down_14px.png">
            </button>-->
        </div>

        <!-- extended form -->
        <div class="wrap-best-search-extended" id="extendedBestSearch" style="display: none;">
            <!--
            <div class="wrap-best-search-title">
                <div class="wrap-best-search-title-time">
                    <div class="best-search-title">
                        <div class="best-search-title-label">인기검색어</div>
                    </div>
                    <div class="best-search-current-time">
                        <div class="current-time">00.00 00:00</div>
                        <div class="current-time-text">기준</div>
                    </div>
                </div>
                <button class="ic_chevron_up_14px" id="toggleBtnAfter">
                    <img src="/images/ic_chevron_down_14px.png">
                </button>
            </div>

                       <div class="best-search-keyword-extended">
                            <div class="wrap-num-name">
                                <div class="num-extended">1</div>
                                <div class="name-extended">-</div>
                            </div>
                            <div class="wrap-rank-extended">
                                <div class="rank-up-extended">new</div>
                            </div>
                        </div>
                        <div class="best-search-keyword-extended">
                            <div class="wrap-num-name">
                                <div class="num-extended">2</div>
                                <div class="name-extended">-</div>
                            </div>
                            <div class="wrap-rank-extended">
                                <div class="rank-up-extended">new</div>
                            </div>
                        </div>
                        <div class="best-search-keyword-extended">
                            <div class="wrap-num-name">
                                <div class="num-extended">3</div>
                                <div class="name-extended">-</div>
                            </div>
                            <div class="wrap-rank-extended">
                                <div class="rank-up-extended">new</div>
                            </div>
                        </div>
                        <div class="best-search-keyword-extended">
                            <div class="wrap-num-name">
                                <div class="num-extended">4</div>
                                <div class="name-extended">-</div>
                            </div>
                            <div class="wrap-rank-extended">
                                <div class="rank-up-extended">new</div>
                            </div>
                        </div>
                        <div class="best-search-keyword-extended">
                            <div class="wrap-num-name">
                                <div class="num-extended">5</div>
                                <div class="name-extended">-</div>
                            </div>
                            <div class="wrap-rank-extended">
                                <div class="rank-up-extended">new</div>
                            </div>
                        </div>
                        <div class="best-search-keyword-extended">
                            <div class="wrap-num-name">
                                <div class="num-extended">6</div>
                                <div class="name-extended">-</div>
                            </div>
                            <div class="wrap-rank-extended">
                                <div class="rank-up-extended">new</div>
                            </div>
                        </div>
                        <div class="best-search-keyword-extended">
                            <div class="wrap-num-name">
                                <div class="num-extended">7</div>
                                <div class="name-extended">-</div>
                            </div>
                            <div class="wrap-rank-extended">
                                <div class="rank-up-extended">new</div>
                            </div>
                        </div>
                        <div class="best-search-keyword-extended">
                            <div class="wrap-num-name">
                                <div class="num-extended">8</div>
                                <div class="name-extended">-</div>
                            </div>
                            <div class="wrap-rank-extended">
                                <div class="rank-up-extended">new</div>
                            </div>
                        </div>
                        <div class="best-search-keyword-extended">
                            <div class="wrap-num-name">
                                <div class="num-extended">9</div>
                                <div class="name-extended">-</div>
                            </div>
                            <div class="wrap-rank-extended">
                                <div class="rank-down-extended">new</div>
                            </div>
                        </div>
                        <div class="best-search-keyword-extended">
                            <div class="wrap-num-name">
                                <div class="num-extended">10</div>
                                <div class="name-extended">-</div>
                            </div>
                            <div class="wrap-rank-extended">
                                <div class="rank-down-extended">new</div>
                            </div>
                        </div>-->
        </div>
    </section>

    <!-- Content -->
    <section class="wrap-search-contents">
        <div class="wrap-search-contents-recent">
            <div class="wrap-recent-title-delete">
                <div class="recent-title-label">최근검색어</div>
                <div class="recent-delete-label">전체삭제</div>
            </div>
            <div class="wrap-btn-search-history" id="recentSearchWordContainer">
                <!-- (1) 최근 검색어가 없는 경우 -->
                <!--            <div class="recent-no-data-text">최근 검색어가 없습니다.</div>-->
                <!-- (2) 최근 검색어가 있는 경우 -->
                <!--            <div class="btn-search-history">-->
                <!--                <div class="btn-search-history-label">혼술와인</div>-->
                <!--                <img src="/images/bar.png" class="btn-search-history-bar">-->
                <!--                <img src="/images/ic_close_14px.png" class="ic_close_14px">-->
                <!--            </div>-->
            </div>
        </div>

        <div class="wrap-search-contents-best-seller">
            <div class="wrap-best-title-plus">
                <div class="best-title-label">오늘의 칠링필링 인기 상품</div>
            </div>

            <div class="home-taste-prod-swiper-wrapper" id="productCards">
                <!-- Items 기본 2개 이상 노출하고 옆으로 넘기도록 (swipe) -->
                <div class="product-cards-inner">
                </div>

            </div>
        </div>
    </section>

    <!-- Footer -->
    <section class="bottom" id="footer">
    </section>

</div>
</body>
<script th:inline="javascript">
    let popularGoodsViewList;

    let recentSearchWordContainer = document.getElementById('recentSearchWordContainer');

    let beforeContent = document.getElementById('simplyBestSearch');
    let afterContent = document.getElementById('extendedBestSearch');

    let searchInput = document.getElementById('searchInput');
    let searchButton = document.getElementById('searchButton');
    let searchClear = document.getElementById('searchInputClear');

    let productsFrame = document.getElementById("productCards");
    let innerSlider = document.querySelector(".product-cards-inner")
    let pressed = false;
    let startX, nowX;

    window.onload = async function () {
        createFooter('/category');

        await displaySearchHistoryBtn(recentSearchWordContainer);

        popularGoodsViewList = await getPopularGoodsList(30);

        for (let i = 0; i < popularGoodsViewList.length; i++) {
            createItemCard01(innerSlider, popularGoodsViewList[i]);
        }
        setSwiperSlide(productsFrame, innerSlider);
        createFormBestSearchedKeywordHead(beforeContent, getBestSearchedKeyWord());
        createFormBestSearchedKeywordList(afterContent, getBestSearchedKeyWordList());
        activeGoodsDetailsURL();

        document.getElementById('toggleBtnBefore').addEventListener('click', function (e) {
            e.preventDefault();
            beforeContent.style.display = 'none';
            afterContent.style.display = 'flex';
        });

        document.getElementById('toggleBtnAfter').addEventListener('click', function (e) {
            e.preventDefault();
            afterContent.style.display = 'none';
            beforeContent.style.display = 'flex';
        });

    }

    function getBestSearchedKeyWord() {
        return {
            rank: 1,
            name: '여름휴가',
            searchCount: 1000,
            previousRank: 11
        };
    }

    function getBestSearchedKeyWordList() {
        return [
            {
                rank: 1,
                name: '여름휴가',
                searchCount: 1000,
                previousRank: 11
            },
            {
                rank: 2,
                name: '피서',
                searchCount: 900,
                previousRank: 3
            },
            {
                rank: 3,
                name: '혼술',
                searchCount: 800,
                previousRank: 20
            },
            {
                rank: 4,
                name: '하이볼',
                searchCount: 700,
                previousRank: 23
            },
            {
                rank: 5,
                name: '발베니 15년산',
                searchCount: 600,
                previousRank: 5
            },
            {
                rank: 6,
                name: '파티',
                searchCount: 500,
                previousRank: 50
            },
            {
                rank: 7,
                name: '샴페인',
                searchCount: 400,
                previousRank: 7
            },
            {
                rank: 8,
                name: '피노누아',
                searchCount: 300,
                previousRank: 71
            },
            {
                rank: 9,
                name: '혼술 와인',
                searchCount: 200,
                previousRank: 8
            },
            {
                rank: 10,
                name: '와인 선물',
                searchCount: 100,
                previousRank: 19
            }
        ];
    }

    function createFormBestSearchedKeywordHead(parentElement, keyword) {
        if (parentElement == null) {
            console.log('parentElement is null');
            return;
        }

        const wrapDiv = document.createElement('div');
        wrapDiv.className = 'wrap-best-search-tit-keyword';

        const titleDiv = document.createElement('div');
        titleDiv.className = 'best-search-title';

        const titleLabelDiv = document.createElement('div');
        titleLabelDiv.className = 'best-search-title-label';
        titleLabelDiv.textContent = '인기검색어';

        titleDiv.appendChild(titleLabelDiv);
        wrapDiv.appendChild(titleDiv);

        const keywordDiv = document.createElement('div');
        keywordDiv.className = 'best-search-keyword';

        const keywordNumDiv = document.createElement('div');
        keywordNumDiv.className = 'best-search-keyword-num';
        keywordNumDiv.textContent = keyword.rank + ". ";

        const keywordNameDiv = document.createElement('div');
        keywordNameDiv.className = 'best-search-keyword-name';
        keywordNameDiv.textContent = keyword.name;

        let keywordRankUpElement;

        if (keyword.previousRank > 10) {
            // 텍스트의 경우 (예: new)
            keywordRankUpElement = document.createElement('div');
            keywordRankUpElement.className = 'best-search-keyword-rank-up';
            keywordRankUpElement.textContent = 'new';
        }
        else {
            // 이미지의 경우 (예: up arrow, down arrow, line)
            keywordRankUpElement = document.createElement('img');
            if (keyword.rank === keyword.previousRank) {
                keywordRankUpElement.src = '/images/ic_rank_line_10px.png';
                keywordRankUpElement.className = 'ic_rank_line_10px';
            } else if (keyword.rank < keyword.previousRank) {
                keywordRankUpElement.src = '/images/ic_arrow_drop_up_10px.png';
                keywordRankUpElement.className = 'ic_arrow_drop_up_10px';
            } else {
                keywordRankUpElement.src = '/images/ic_arrow_drop_down_10px.png';
                keywordRankUpElement.className = 'ic_arrow_drop_down_10px';
            }
        }

        keywordDiv.appendChild(keywordNumDiv);
        keywordDiv.appendChild(keywordNameDiv);
        keywordDiv.appendChild(keywordRankUpElement);
        wrapDiv.appendChild(keywordDiv);

        const toggleBtn = document.createElement('button');
        toggleBtn.className = 'ic_chevron_down_14px';
        toggleBtn.id = 'toggleBtnBefore';

        const toggleBtnImg = document.createElement('img');
        toggleBtnImg.src = '/images/ic_chevron_down_14px.png';

        toggleBtn.appendChild(toggleBtnImg);

        document.body.appendChild(wrapDiv);
        document.body.appendChild(toggleBtn);

        parentElement.appendChild(wrapDiv);
        parentElement.appendChild(toggleBtn);
    }

    function createFormBestSearchedKeyword(parentElement, keyword) {
        const bestSearchKeywordExtended = document.createElement('div');
        bestSearchKeywordExtended.className = 'best-search-keyword-extended';

        const wrapNumName = document.createElement('div');
        wrapNumName.className = 'wrap-num-name';

        const numExtended = document.createElement('div');
        numExtended.className = 'num-extended';
        numExtended.textContent = keyword.rank + ". ";

        const nameExtended = document.createElement('div');
        nameExtended.className = 'name-extended';
        nameExtended.textContent = keyword.name;

        wrapNumName.appendChild(numExtended);
        wrapNumName.appendChild(nameExtended);

        const wrapRankExtended = document.createElement('div');
        wrapRankExtended.className = 'wrap-rank-extended';

        let rankUpExtended;

        if (keyword.previousRank > 10) {
            // 텍스트의 경우 (예: new)
            rankUpExtended = document.createElement('div');
            rankUpExtended.className = 'rank-up-extended';
            rankUpExtended.textContent = 'new';
        }
        else {
            // 이미지의 경우 (예: up arrow, down arrow, line)
            rankUpExtended = document.createElement('img');
            if (keyword.rank === keyword.previousRank) {
                rankUpExtended.src = '/images/ic_rank_line_10px.png';
                rankUpExtended.className = 'ic_rank_line_10px';
            } else if (keyword.rank > keyword.previousRank) {
                rankUpExtended.src = '/images/ic_arrow_drop_up_10px.png';
                rankUpExtended.className = 'ic_arrow_drop_up_10px';
            } else {
                rankUpExtended.src = '/images/ic_arrow_drop_down_10px.png';
                rankUpExtended.className = 'ic_arrow_drop_down_10px';
            }
        }

        wrapRankExtended.appendChild(rankUpExtended);

        bestSearchKeywordExtended.appendChild(wrapNumName);
        bestSearchKeywordExtended.appendChild(wrapRankExtended);

        parentElement.appendChild(bestSearchKeywordExtended);
    }

    function createFormBestSearchedKeywordList(parentElement, keywords) {
        if (parentElement == null) {
            console.log('parentElement is null');
            return;
        }

        const wrapBestSearchTitle = document.createElement('div');
        wrapBestSearchTitle.className = 'wrap-best-search-title';

        const wrapBestSearchTitleTime = document.createElement('div');
        wrapBestSearchTitleTime.className = 'wrap-best-search-title-time';

        const bestSearchTitle = document.createElement('div');
        bestSearchTitle.className = 'best-search-title';

        const bestSearchTitleLabel = document.createElement('div');

        bestSearchTitleLabel.className = 'best-search-title-label';
        bestSearchTitleLabel.textContent = '인기검색어';

        bestSearchTitle.appendChild(bestSearchTitleLabel);

        const bestSearchCurrentTime = document.createElement('div');
        bestSearchCurrentTime.className = 'best-search-current-time';

        const currentTime = document.createElement('div');
        currentTime.className = 'current-time';

        let nowDate = new Date();
        let month = nowDate.getMonth() + 1;    // because it returns value 0 ~ 11
        let date = nowDate.getDate();
        let hours = nowDate.getHours();
        let minutes = nowDate.getMinutes();
        currentTime.textContent = (month > 9 ? month : '0' + month)
            + '.' + (date > 9 ? date : '0' + date)
            + ' ' + (hours > 9 ? hours : '0' + hours)
            + ':' + (minutes > 9 ? minutes : '0' + minutes);

        const currentTimeText = document.createElement('div');
        currentTimeText.className = 'current-time-text';
        currentTimeText.textContent = '기준';

        bestSearchCurrentTime.appendChild(currentTime);
        bestSearchCurrentTime.appendChild(currentTimeText);

        wrapBestSearchTitleTime.appendChild(bestSearchTitle);
        wrapBestSearchTitleTime.appendChild(bestSearchCurrentTime);

        const icChevronUp14px = document.createElement('button');
        icChevronUp14px.className = 'ic_chevron_up_14px';
        icChevronUp14px.id = 'toggleBtnAfter';

        const icChevronUp14pxImg = document.createElement('img');
        icChevronUp14pxImg.src = '/images/ic_chevron_down_14px.png';

        icChevronUp14px.appendChild(icChevronUp14pxImg);

        wrapBestSearchTitle.appendChild(wrapBestSearchTitleTime);
        wrapBestSearchTitle.appendChild(icChevronUp14px);

        parentElement.appendChild(wrapBestSearchTitle);

        for (let i = 0; i < keywords.length; i++) {
            createFormBestSearchedKeyword(parentElement, keywords[i]);
        }
    }

    searchClear.addEventListener("mouseenter", function() {
        searchClear.addEventListener("click", function() {
            searchInput.value = "";
        });
    });

    searchClear.addEventListener("mouseout", function() {
        searchInput.addEventListener("focusout", function() {
            searchClear.style.display = "none";
        });
    });

    searchInput.addEventListener("focusin", function() {
        if (searchInput.value !== "") {
            searchClear.style.display = "flex";
        }
    });

    searchInput.addEventListener('keyup', function (e) {
        if (e.key === 'Enter') {
            getSearchResult(searchInput.value.trim());
        }
    });

    searchButton.addEventListener('click', function () {
        getSearchResult(searchInput.value.trim());
    });

</script>
</html>